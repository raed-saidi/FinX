import{j as e}from"./@radix-D8tIKeo-.js";import{S as y}from"./plus-BjxzjZ9E.js";import{S as C}from"./refresh-DNxZUtB4.js";import{S as w}from"./SearchField-CKsasr6A.js";import{ai as m,B as p,r as o,e as h,a4 as D,J as v,N,O as b,Q as P,R as k,U as A,V as x,b8 as R,a1 as f,b9 as T,T as _,a2 as I,aU as B,ba as F,aJ as E,aK as L}from"./index-rPJfPIfq.js";import{b as g}from"./@tanstack-nMqraTcu.js";import{L as i,f as O}from"./@react-router-D1ODL_Ub.js";import{B as U}from"./button-group-basic-CIkfchJY.js";import{P as Q}from"./Pagination-BrbDDVUm.js";import{z as l}from"./@zod-2qqdh1cM.js";import{D as z}from"./deployment-status-tag-DsU2fBJY.js";import{S as M}from"./trash-Dp8wQrEE.js";import{D as q,a as G}from"./DeleteAlertDialog-BY_bckaz.js";import{c as H}from"./helper-Bk0vl-dI.js";import{u as J}from"./update-snapshot-C3TLBVmM.js";import{u as K}from"./bulk-delete-C9yvNCO6.js";import{a as V}from"./@monaco-editor-CuNQBT0l.js";import{P as $}from"./pipeline-link-dO1b6Am8.js";const{ContextProvider:Se,useContext:c}=H();function j(){const{setRowSelection:t}=c(),{mutateAsync:s}=J();async function n(a){await s({snapshotId:a,payload:{name:!1}})}return K({deleteFn:n,queryKeyToInvalidate:m.all,setRowSelection:t})}function W(){const{selectedRowCount:t,selectedRowIDs:s}=c(),{bulkDelete:n}=j();async function a(){await n(s)}return e.jsx(U,{itemName:"Pipeline Snapshot",selectedItemCount:t,onDeleteSelected:a})}function ye({params:t,displayCreateButton:s=!1}){const{refetch:n}=g({...m.list(t),throwOnError:!0}),{selectedRowCount:a}=c();return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1",children:[a?e.jsx(W,{}):e.jsx(w,{searchParams:t}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(p,{className:"bg-theme-surface-primary",intent:"primary",emphasis:"subtle",size:"md",onClick:()=>n(),children:[e.jsx(C,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),s&&e.jsx(p,{className:"whitespace-nowrap",asChild:!0,size:"md",children:e.jsxs(i,{to:o.projects.snapshots.create,children:[e.jsx(y,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"Create Snapshot"})]})})]})]})}function Ce({params:t,columns:s}){const{rowSelection:n,setRowSelection:a}=c(),r=g({...m.list(t),throwOnError:!0});if(r.isPending)return e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:e.jsx(h,{className:"h-[500px] w-full"})}),e.jsx(h,{className:"h-[36px] w-[300px]"})]});if(r.isError)return e.jsx("p",{children:"Error fetching snapshots"});const u=r.data;return e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:e.jsx(D,{columns:s,data:u.items,rowSelection:n,onRowSelectionChange:a,getRowId:S=>S.id})}),u.total_pages>1&&e.jsx(Q,{searchParams:t,paginate:u})]})}const d=1,X=l.object({page:l.coerce.number().min(d).optional().default(d).catch(d),name:l.string().optional(),operator:l.enum(["and","or"]).optional()});function we(){const[t]=O(),{page:s,name:n,operator:a}=X.parse({page:t.get("page")||void 0,name:t.get("name")||void 0});return{page:s,name:n,logical_operator:a}}function Y({deleteHandler:t}){return e.jsx(q,{title:"Delete Pipeline Snapshots",handleDelete:t,children:e.jsxs(G,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}function Z({deleteHandler:t,open:s,setOpen:n}){return e.jsx(v,{open:s,onOpenChange:n,children:e.jsx(Y,{deleteHandler:t})})}function ee({snapshotId:t}){const[s,n]=V.useState(!1),{bulkDelete:a}=j();async function r(){await a([t]),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(Z,{deleteHandler:r,open:s,setOpen:n}),e.jsxs(N,{children:[e.jsx(b,{asChild:!0,children:e.jsx(p,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:e.jsx(P,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),e.jsx(k,{align:"end",sideOffset:7,children:e.jsxs(A,{onClick:()=>n(!0),className:"cursor-pointer space-x-2",children:[e.jsx(M,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})})]})]})}function De(){return{id:"check",header:({table:t})=>e.jsx(x,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),meta:{width:"1%"},cell:({row:t})=>e.jsx(x,{id:t.id,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler(),className:"h-3 w-3"})}}function ve(){return{id:"name",header:"Snapshot",accessorFn:t=>t.name,cell:({row:t})=>{const s=t.original.name,n=t.original.id;return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 shrink-0 fill-primary-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{to:o.projects.snapshots.detail.overview(n),className:"grid grid-cols-1 items-center gap-1",children:e.jsx("span",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:s??"Unnamed"})}),e.jsx(f,{copyText:s??""})]}),e.jsxs(i,{to:o.projects.snapshots.detail.overview(n),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:T(n)}),e.jsx(f,{copyText:n})]})]})]})}}}function Ne(){return{id:"deployment",header:"Deployment",accessorFn:t=>t.resources?.deployment?.id,cell:({row:t})=>{const s=t.original.resources?.deployment,n=s?.body?.status,a=s?.id;return!n||!a?null:e.jsx(i,{to:o.projects.deployments.detail.overview(a),children:e.jsx(z,{status:n})})}}}function be(){return{id:"pipeline",header:"Pipeline",accessorFn:t=>t.resources?.pipeline?.name,cell:({row:t})=>{const s=t.original.resources?.pipeline;return s?e.jsx($,{pipelineId:s.id,pipelineName:s.name}):null}}}function Pe(){return{id:"latest-run",header:"Latest Run",accessorFn:t=>t.resources?.latest_triggered_run_id,cell:({row:t})=>{const s=t.original.resources?.latest_run_id,n=t.original.resources?.latest_run_status;return!s||!n?e.jsx("div",{children:"No run"}):e.jsx(i,{to:o.projects.runs.detail(s),children:e.jsxs(_,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:I(n),children:[e.jsx(B,{className:`h-3 w-3 ${F(n)}`}),s?.split("-")[0]]})})}}}function ke(){return{id:"latest-run-author",header:"Latest Run Author",accessorFn:t=>t.resources?.latest_run_author,cell:({row:t})=>{const s=t.original.resources?.user;return s?e.jsx(E,{username:s.name,isServiceAccount:!!s.body?.is_service_account,avatarUrl:s.body?.avatar_url??void 0}):null}}}function Ae(){return{id:"created",header:"Created at",accessorFn:t=>({date:t.body?.created}),cell:({getValue:t})=>{const{date:s}=t();return e.jsx(L,{dateString:s})}}}function Re(){return{id:"admin_actions",header:void 0,accessorFn:t=>t.id,cell:({row:t})=>{const s=t.original.id;return e.jsx(ee,{snapshotId:s})}}}export{Ce as P,ye as S,ve as a,Ne as b,De as c,Pe as d,ke as e,Ae as f,Re as g,Se as h,be as i,we as u};
