import{j as e}from"./@radix-D8tIKeo-.js";import{c as S}from"./helper-Bk0vl-dI.js";import{F as C,G as T,H as k,p as g,J as j,K as _,B as f,L as w,N as R,O as A,Q as E,R as I,U as O,V as m,W as F,X as B,r as d,Y as z,Z as L,_ as $,$ as M,a0 as G,a1 as h,T as H,a2 as Q,a3 as q,a4 as K,e as x}from"./index-rPJfPIfq.js";import{c as U,b as J}from"./@tanstack-nMqraTcu.js";import{u as V}from"./bulk-delete-C9yvNCO6.js";import{S as W}from"./refresh-DNxZUtB4.js";import{P as X}from"./Pagination-BrbDDVUm.js";import{S as Y}from"./SearchField-CKsasr6A.js";import{S as Z}from"./alert-triangle-DTrw87FZ.js";import{S as v}from"./trash-Dp8wQrEE.js";import{D,a as P}from"./DeleteAlertDialog-BY_bckaz.js";import{a as y}from"./@monaco-editor-CuNQBT0l.js";import{L as u,f as ee}from"./@react-router-D1ODL_Ub.js";import{z as l}from"./@zod-2qqdh1cM.js";import"./@elkjs-CmhuJAjY.js";import"./@reactflow-DgowYF6H.js";import"./chevron-right-double-DLhLU36B.js";async function te({pipelineId:t}){const s=C(k.pipelines.detail(t)),n=await fetch(s,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const a=await n.json().then(i=>i.detail).catch(()=>`Failed to delete pipeline ${t}`);throw new T({status:n.status,statusText:n.statusText,message:a})}return n.json()}function se(t){return U({mutationFn:te,...t})}const{ContextProvider:ne,useContext:o}=S();function b(){const{setRowSelection:t}=o(),{mutateAsync:s}=se();async function n(a){await s({pipelineId:a})}return V({deleteFn:n,queryKeyToInvalidate:g.all,setRowSelection:t})}function ae(){const[t,s]=y.useState(!1),{selectedRowCount:n,selectedRowIDs:a}=o(),{bulkDelete:i}=b();async function c(){await i(a),s(!1)}const r=w(n,"Pipeline"),N=`Delete ${r}`;return e.jsxs(j,{open:t,onOpenChange:s,children:[e.jsx(_,{asChild:!0,children:e.jsxs(f,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(v,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(D,{title:N,handleDelete:c,children:e.jsxs(P,{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]}),e.jsx("div",{className:"space-y-3 rounded-md border border-warning-300 bg-warning-50 px-2 py-1 text-warning-900",children:e.jsxs("div",{className:"flex items-center gap-2 text-text-sm",children:[e.jsx(Z,{width:24,height:24,className:"shrink-0 fill-warning-700"}),e.jsxs("p",{children:["This will also delete all runs and snapshots associated with the ",r,"."]})]})})]})})]})}function ie(){const{selectedRowCount:t}=o(),s=w(t,"Pipeline");return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${t} ${s} selected`}),e.jsx(ae,{})]})}function re({id:t}){const[s,n]=y.useState(!1),{bulkDelete:a}=b();async function i(){await a([t]),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(j,{open:s,onOpenChange:n,children:e.jsx(D,{title:"Delete Pipeline",handleDelete:i,children:e.jsxs(P,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}),e.jsxs(R,{children:[e.jsx(A,{children:e.jsx(E,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsx(I,{align:"end",sideOffset:7,children:e.jsx(O,{onSelect:()=>n(!0),icon:e.jsx(v,{}),children:"Delete"})})]})]})}function le(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(m,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(m,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Pipeline",cell:({row:t})=>e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(F,{className:`h-5 w-5 shrink-0 ${B(t.original.resources?.latest_run_status)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{to:d.projects.pipelines.detail.runs(t.original.id),className:"grid grid-cols-1 items-center gap-1",children:e.jsx("span",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:t.original.name})}),e.jsx(z,{children:e.jsxs(L,{children:[e.jsx($,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(M,{status:t.original.resources?.latest_run_status})}),e.jsx(G,{className:"z-20 capitalize",children:t.original.resources?.latest_run_status})]})}),e.jsx(h,{copyText:t.original.name})]}),e.jsxs(u,{to:d.projects.pipelines.detail.runs(t.original.id),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:t.original.id.split("-")[0]}),e.jsx(h,{copyText:t.original.id})]})]})]})},{id:"latest-run",header:"Latest Run",accessorFn:t=>({status:t.resources?.latest_run_status,runId:t.resources?.latest_run_id}),cell:({getValue:t})=>{const{runId:s,status:n}=t();return!s||!n?e.jsx("div",{children:"No run"}):e.jsx(u,{to:d.projects.runs.detail(s),children:e.jsxs(H,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:Q(n),children:[e.jsx(q,{className:"h-3 w-3 fill-current"}),s?.split("-")[0]]})})}},{id:"admin_actions",header:"",meta:{width:"5%"},cell:({row:t})=>e.jsx(re,{id:t.original.id})}]}const p=1,oe=l.object({page:l.coerce.number().min(p).optional().default(p).catch(p),name:l.string().optional(),operator:l.enum(["and","or"]).optional()});function ce(){const[t]=ee(),{page:s,name:n,operator:a}=oe.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:n,logical_operator:a}}function de(){const t=ce(),{selectedRowCount:s,rowSelection:n,setRowSelection:a}=o(),{data:i,refetch:c}=J({...g.pipelineList({...t,sort_by:"desc:latest_run"}),throwOnError:!0});return e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[s?e.jsx(ie,{}):e.jsx(Y,{searchParams:t}),e.jsx("div",{className:"flex justify-between",children:e.jsxs(f,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>c(),children:[e.jsx(W,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:i?e.jsx(K,{rowSelection:n,onRowSelectionChange:a,getRowId:r=>r.id,columns:le(),data:i.items}):e.jsx(x,{className:"h-[500px] w-full"})}),i?i.total_pages>1&&e.jsx(X,{searchParams:t,paginate:i}):e.jsx(x,{className:"h-[36px] w-[300px]"})]})]})}function Te(){return e.jsx(ne,{children:e.jsx(de,{})})}export{Te as default};
