import{j as e}from"./@radix-D8tIKeo-.js";import{E as h,F as f,G as y,H as j,bk as g,bm as v,at as N,B as l,aa as m,bC as x,bB as b,e as C,C as w,o as k,q as S,t as D,x as E}from"./index-rPJfPIfq.js";import{S as P}from"./chevron-down-C9YWkVDM.js";import{I as _}from"./Infobox-B90R5I3r.js";import{a as u}from"./@monaco-editor-CuNQBT0l.js";import{c as F,b as R}from"./@tanstack-nMqraTcu.js";import{a as T}from"./@react-router-D1ODL_Ub.js";import{F as z}from"./icon-CfaCsugE.js";import"./@elkjs-CmhuJAjY.js";import"./@reactflow-DgowYF6H.js";import"./@zod-2qqdh1cM.js";import"./alert-triangle-DTrw87FZ.js";async function B({connectorId:s}){const t=f(j.serviceConnectors.verifyExisting(s)),r=await h(t,{method:"PUT",headers:{"Content-Type":"application/json"}});if(!r.ok){const n=await r.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>"Failed to verify connector");throw new y({status:r.status,statusText:r.statusText,message:n})}return r.json()}function O(s){return F({...s,mutationFn:async({connectorId:t})=>B({connectorId:t})})}const V="/assets/connectivity-4UKGMYnr.webp";function I({open:s,isLoading:t,isError:r,onClose:n,onSuccess:i,data:c}){const a=!!c?.error,o=c?.error??void 0;return e.jsx(g,{open:s,children:e.jsx(v,{onPointerDownOutside:d=>t?d.preventDefault():n?.(),onEscapeKeyDown:d=>t?d.preventDefault():n?.(),className:"max-w-[540px] p-8",children:e.jsxs("div",{className:"flex w-full flex-col items-center justify-center space-y-5",children:[t&&!c&&e.jsx(A,{onClose:n}),!t&&!r&&!a&&e.jsx(Q,{onSuccess:i}),!t&&(r||a)&&e.jsx(G,{error:o,onClose:n})]})})})}function A({onClose:s}){return e.jsxs(e.Fragment,{children:[e.jsx(N,{}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Verifying your service connector"}),e.jsxs("p",{className:"text-text-lg text-theme-text-secondary",children:["Please wait while we check your connection ",e.jsx("br",{}),"This may take up to a minute."]})]}),e.jsx(l,{size:"md",emphasis:"subtle",onClick:s,intent:"secondary",className:"mt-4",children:"Cancel"})]})}function Q({onSuccess:s}){return e.jsxs(e.Fragment,{children:[e.jsx(m,{width:180,height:180,className:"fill-theme-text-success"}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Connection verified successfully!"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"Ready to show your available resources"})]}),e.jsx(l,{size:"md",onClick:s,className:"mt-4",children:"Display Resources"})]})}function G({onClose:s,error:t}){return e.jsxs(e.Fragment,{children:[e.jsx("img",{src:V,alt:"Connectivity",width:180,height:180}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"We couldn't verify your connection"}),t&&e.jsx("p",{className:"max-h-[250px] overflow-auto rounded-md border border-theme-border-moderate bg-theme-surface-secondary p-1 text-left font-mono",children:t}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"Please try again to list your resources"})]}),e.jsx(l,{size:"md",emphasis:"subtle",onClick:s,intent:"secondary",className:"mt-4",children:"Close"})]})}function p({children:s}){const{setResources:t}=x(),{connectorId:r}=T(),n=R({...b.serviceConnectorDetail(r),throwOnError:!0}),[i,c]=u.useState(!1),a=O();if(n.isPending)return e.jsx(C,{className:"h-7 w-[150px]"});if(n.isError)return null;const o=()=>{c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{data:a.data,open:i,isLoading:a.isPending,isError:a.isError,onClose:o,onSuccess:()=>{a.data&&(t(a.data),c(!1))}}),e.jsxs(l,{disabled:a.isPending&&i,onClick:()=>{c(!0),a.mutate({connectorId:r})},className:"gap-1",size:"md",children:[e.jsx(m,{width:24,height:24,className:"size-5 shrink-0 fill-white"}),s]})]})}function H(){const{resources:s}=x();if(!s)return null;const t=s.connector_type;return!t||typeof t=="string"?null:e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{children:e.jsx("span",{children:"Reverify now"})})}),s.resources?.map(r=>e.jsx(K,{title:t.resource_types.find(n=>n.resource_type===r.resource_type)?.name,logoUrl:t.resource_types.find(n=>n.resource_type===r.resource_type)?.logo_url??void 0,resource:r},r.resource_type))]})}function K({resource:s,title:t,logoUrl:r}){const[n,i]=u.useState(!0),c=s.error,a=s.resource_ids??[];return e.jsxs(w,{open:n,onOpenChange:i,children:[e.jsx(k,{className:"flex items-center gap-[10px]",children:e.jsxs(S,{className:"flex w-full items-center gap-[10px] text-text-lg",children:[e.jsx(P,{className:` ${n?"":"-rotate-90"} h-5 w-5 rounded-md fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200`}),t||s.resource_type]})}),e.jsx(D,{className:"space-y-5 border-t border-theme-border-moderate bg-theme-surface-primary",children:c?e.jsx("div",{className:"p-5",children:e.jsx(_,{intent:"error",children:c})}):e.jsx("ul",{className:"divide-y divide-theme-border-moderate",children:a.map(o=>e.jsxs("li",{className:"flex items-center space-x-2 py-3 pl-8",children:[!!r&&e.jsx("img",{width:24,height:24,src:r,alt:t,className:"size-5 shrink-0"}),e.jsx("span",{children:o})]},o))})})]})}function M(){return e.jsx("div",{className:"p-9",children:e.jsxs("div",{className:"flex flex-col items-center space-y-5",children:[e.jsx(z,{icon:e.jsx(E,{className:"h-[36px] w-[36px] fill-primary-400"})}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Please verify your service connector"}),e.jsxs("p",{className:"text-text-lg text-theme-text-secondary",children:["We'll check your connection and load available resources.",e.jsx("br",{}),"This may take up to a minute."]})]}),e.jsx(p,{children:e.jsx("span",{children:"Verify now"})})]})})}function re(){const{resources:s}=x();return s===null?e.jsx(M,{}):e.jsx(H,{})}export{re as default};
