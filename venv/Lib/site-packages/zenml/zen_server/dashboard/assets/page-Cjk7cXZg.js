import{j as e}from"./@radix-D8tIKeo-.js";import{E as v,F as w,aT as z,G as b,H as D,J as B,bk as k,N as I,O as K,B as o,Q as $,R,U as g,bu as U,r as y,a1 as N,aJ as H,aK as J,u as G,e as f,bl as W,bm as X,bn as Y,D as Z,w as ee,I as x,bq as se,br as te,bs as ae,a4 as re,k as ne}from"./index-rPJfPIfq.js";import{P as ie}from"./Pagination-BrbDDVUm.js";import{S as le}from"./SearchField-CKsasr6A.js";import{E as ce,S as oe,s as me,a as de}from"./SecretTooltip-hhvJoj6C.js";import{c as C,h as E,b as ue}from"./@tanstack-nMqraTcu.js";import{S as xe}from"./Lock-DZqSjziZ.js";import{c as he}from"./code-snippets-Cro2ORGr.js";import{L as S,f as pe}from"./@react-router-D1ODL_Ub.js";import{S as T}from"./trash-Dp8wQrEE.js";import{a as j}from"./@monaco-editor-CuNQBT0l.js";import{D as fe,a as je}from"./DeleteAlertDialog-BY_bckaz.js";import{z as m,u as ge,t as ye,b as Ne,C as h}from"./@zod-2qqdh1cM.js";import{S as Se}from"./eye-CuzpINsY.js";import{S as F}from"./plus-BjxzjZ9E.js";import"./@elkjs-CmhuJAjY.js";import"./@reactflow-DgowYF6H.js";import"./chevron-right-double-DLhLU36B.js";import"./CodeSnippet-CsgVLbdO.js";async function ve(s){const t=w(D.secrets.detail(s)),a=await v(t,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(a.status===404&&z(),!a.ok)throw new b({message:"Error deleting secret",status:a.status,statusText:a.statusText});return a.json()}function we(s){return C({mutationFn:async t=>ve(t),...s})}function be({secretId:s,open:t,setOpen:a}){const r=E(),{mutate:c}=we({onSuccess(){r.invalidateQueries({queryKey:["secrets"]})}});function d(){c(s)}return e.jsx(B,{open:t,onOpenChange:a,children:e.jsx(fe,{title:"Delete Secret",handleDelete:d,children:e.jsxs(je,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})}function De({secretId:s}){const[t,a]=j.useState(!1),[r,c]=j.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(be,{secretId:s,open:t,setOpen:a}),e.jsx(k,{open:r,onOpenChange:c,children:e.jsx(ce,{secretId:s,isSecretNameEditable:!0,dialogTitle:"Edit secret"})}),e.jsxs(I,{children:[e.jsx(K,{asChild:!0,children:e.jsx(o,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:e.jsx($,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),e.jsxs(R,{align:"end",sideOffset:7,children:[e.jsxs(g,{onSelect:()=>c(!0),className:"cursor-pointer space-x-2",children:[e.jsx(U,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]}),e.jsxs(g,{onSelect:()=>a(!0),className:"cursor-pointer space-x-2",children:[e.jsx(T,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}const ke=[{id:"secret",header:"Secret",accessorFn:s=>s.name,cell:({getValue:s,row:t})=>{const a=he(t.original.name);return e.jsxs("div",{className:"flex min-w-[10rem] items-center space-x-2",children:[e.jsx(xe,{className:"h-5 w-5 shrink-0 fill-primary-400"}),e.jsxs("div",{className:"group/copybutton flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(S,{className:"grid grid-cols-1 text-text-md font-semibold text-theme-text-primary",to:y.settings.secrets.detail(t.original.id),children:e.jsx("span",{className:"truncate",children:t.original.name})}),e.jsx(oe,{code:a})]}),e.jsx(N,{copyText:s()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{to:y.settings.secrets.detail(t.original.id),className:"flex items-center gap-1 text-text-sm text-theme-text-secondary",children:t.original.id.slice(0,8)}),e.jsx(N,{copyText:t.original.id})]})]})]})}},{id:"author",header:"Author",accessorFn:s=>s.resources?.user?.name,cell:({row:s})=>{const t=s.original.resources?.user;return t?e.jsx(H,{avatarUrl:t.body?.avatar_url??void 0,username:t.name,isServiceAccount:!!t.body?.is_service_account}):null}},{id:"created_at",header:"Created At",accessorFn:s=>s.body?.created,cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(J,{dateString:s()})})},{id:"admin_actions",header:"",accessorFn:s=>String(s.id),cell:({row:s,getValue:t})=>{const a=t();return s.original.resources?.user?.body?.is_admin?e.jsx(De,{secretId:a}):e.jsx("p",{className:"text-sm text-theme-text-secondary",children:"No Actions"})}}],p=1,Ce=m.object({page:m.coerce.number().min(p).optional().default(p).catch(p),name:m.string().optional(),operator:m.enum(["and","or"]).optional()});function Ee(){const[s]=pe(),{page:t,name:a,operator:r}=Ce.parse({page:s.get("page")||void 0,name:s.get("name")||void 0,operator:s.get("operator")||void 0});return{page:t,name:a,logical_operator:r}}async function Te(s){const t=w(D.secrets.all),a=await v(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){const r=await a.json().then(c=>c.detail).catch(()=>"Failed to create Secret");throw new b({status:a.status,statusText:a.statusText,message:r})}return a.json()}function Fe(s){return C({mutationFn:async t=>Te(t),...s})}function Pe(){const[s,t]=j.useState(!1),a=G();if(a.isPending)return e.jsx(f,{className:"h-7 w-full"});if(a.isError)return e.jsx("div",{children:"Error loading user"});const r=a.data.id;return e.jsxs(k,{open:s,onOpenChange:t,children:[e.jsx(W,{asChild:!0,children:e.jsxs(o,{size:"md",className:"shrink-0",intent:"primary",children:[e.jsx(F,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Secret"})]})}),e.jsxs(X,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(Y,{children:e.jsx(Z,{children:"Register New Secret"})}),e.jsx(Ae,{userId:r,setOpen:t})]})]})}function Ae({userId:s,setOpen:t}){const{handleSubmit:a,control:r,watch:c,setValue:d,formState:{isValid:P},reset:A}=ge({resolver:ye(me),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:u,append:O,remove:V}=Ne({control:r,name:"keysValues"}),{toast:_}=ee(),q=E(),{mutate:L}=Fe({onError(n){ae(n)&&_({status:"error",emphasis:"subtle",description:n.message,rounded:!0})},onSuccess(){q.invalidateQueries({queryKey:["secrets"]}),t(!1),A()}}),M=n=>{L({user:s,name:n.secretName,values:n.keysValues.reduce((i,l)=>(l.key&&l.value&&(i[l.key]=l.value),i),{})})},Q=n=>{M(n)};return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-secret-form",className:"gap-5 p-5",onSubmit:a(Q),children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(h,{name:"secretName",control:r,render:({field:n})=>e.jsx(x,{...n,className:"mb-3 w-full",required:!0})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),u.map((n,i)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(h,{name:`keysValues.${i}.key`,control:r,render:({field:l})=>e.jsx(x,{...l,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(h,{name:`keysValues.${i}.value`,control:r,render:({field:l})=>e.jsx(x,{...l,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:c(`keysValues.${i}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>{const l=c(`keysValues.${i}.showPassword`);d(`keysValues.${i}.showPassword`,!l)},className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx(Se,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[i===u.length-1&&e.jsx(o,{intent:"primary",emphasis:"subtle",onClick:()=>O({key:"",value:""}),className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(F,{className:"flex-shrink-0 fill-primary-600"})}),i!==u.length-1&&e.jsx(o,{intent:"secondary",emphasis:"minimal",onClick:()=>V(i),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(T,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},n.id))]})}),e.jsxs(se,{className:"gap-[10px]",children:[e.jsx(te,{asChild:!0,children:e.jsx(o,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(o,{intent:"primary",disabled:!P,type:"submit",form:"create-secret-form",children:"Register Secret"})]})]})}function Oe(){const s=Ee(),{data:t}=ue({...de.secretList({...s,sort_by:"desc:created"}),throwOnError:!0});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(le,{searchParams:s}),e.jsx(Pe,{})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:t?e.jsx(re,{columns:ke,data:t.items}):e.jsx(f,{className:"h-[250px] w-full"})}),t?t.total_pages>1&&e.jsx(ie,{searchParams:s,paginate:t}):e.jsx(f,{className:"h-[36px] w-[300px]"})]})]})}function Ze(){return e.jsxs(ne,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Secrets"}),e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Configure and manage your pipeline secrets and configurations."," ",e.jsx("a",{target:"_blank",rel:"noreferrer noopener",href:"https://docs.zenml.io/how-to/interact-with-secrets",className:"link text-primary-400",children:"Learn More"})]})]}),e.jsx(Oe,{})]})}export{Ze as default};
