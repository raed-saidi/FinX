import{j as e,aB as R,aC as M,aD as S,v as z,aE as F,aF as _}from"./@radix-D8tIKeo-.js";import{bd as B,at as I,w as b,B as d,G as Z,J as $,K as J,c as u,e as Q,aJ as W,k as U,$ as G,r as K,b4 as q,S as X,aM as Y,aE as p,aF as ee,aD as j,bj as g,ai as se,aG as te}from"./index-rPJfPIfq.js";import{b as re,c as ne,l as E,m as ae,g as ie,F as L,a as c}from"./@monaco-editor-CuNQBT0l.js";import{c as oe,h as le,b as O}from"./@tanstack-nMqraTcu.js";import{E as ce}from"./EmptyState-BU9ULL6a.js";import{u as ue,t as de,z as P,C as me}from"./@zod-2qqdh1cM.js";import"./json-faker-Df2OsIQx.js";import{J as pe}from"./@json-schema-faker-DUTixDph.js";import{D as he,a as xe}from"./DeleteAlertDialog-BY_bckaz.js";import{u as fe}from"./delete-run-D3xcQGxl.js";import{L as je,a as ge}from"./@react-router-D1ODL_Ub.js";import{u as ye}from"./pipeline-run-detail-query-CwgnhhNe.js";import{b as Ce,C as x}from"./CollapsibleCard-Dh8SGpzx.js";import{C as be}from"./constants-BUlqx9qT.js";import{S as ve}from"./slash-circle-CpQAWsOq.js";import{P as Ne,a as k,b as we}from"./react-resizable-panels.browser-0v9wo-oN.js";import"./@elkjs-CmhuJAjY.js";import"./@reactflow-DgowYF6H.js";import"./chevron-down-C9YWkVDM.js";const Se=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);self.MonacoEnvironment={getWorker(s,t){return t==="json"?new re:new ne}};E.config({monaco:ae});E.init().then(s=>{s.editor.defineTheme("github-light",ie)});function f({error:s}){return s instanceof Error?e.jsx(m,{title:"An error occurred",subtitle:s.message}):null}function m({subtitle:s,title:t}){return e.jsx(ce,{icon:e.jsx(B,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[t&&e.jsx("div",{className:"mb-2 text-display-xs font-semibold",children:t}),e.jsx("p",{className:"text-lg text-theme-text-secondary",children:s})]})})}function y({subtitle:s}){return e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-2 p-5",children:[e.jsx(I,{}),s&&e.jsx("p",{className:"text-text-lg font-semibold",children:s})]})}function Oe({jsonSchema:s,value:t,onChange:n,deploymentId:a}){const r=`${a}.json`,i=(o,l)=>{l.languages.json.jsonDefaults.setDiagnosticsOptions({enableSchemaRequest:!0,validate:!0,schemas:[{uri:`deployment-input-schema-${a}.json`,fileMatch:[r],schema:s}]})};return e.jsx(L,{theme:"github-light",path:r,value:t,onChange:n,language:"json",options:{minimap:{enabled:!1}},className:"h-full border border-theme-border-moderate",onMount:i})}const Pe=P.object({parameters:P.string()});function ke(s,t){const{toast:n}=b(),a=pe.generate(s),r=ue({resolver:de(Pe),defaultValues:{parameters:JSON.stringify(a,null,"	")}});function i(o){try{t(JSON.parse(o.parameters))}catch(l){l instanceof Error&&n({emphasis:"subtle",status:"error",rounded:!0,description:l.message}),console.error(l)}}return{form:r,handleSubmit:i}}function Ee({snapshot:s,submitDeployment:t,isInvoking:n,deploymentId:a}){const r=s.metadata?.pipeline_spec?.input_schema,{form:i,handleSubmit:o}=ke(r,t);return e.jsxs("form",{onSubmit:i.handleSubmit(o),className:"flex h-full w-full flex-col divide-y divide-theme-border-moderate pl-5 pr-5 xl:pl-[80px] xl:pr-0",children:[e.jsxs("div",{className:"flex h-full flex-col gap-5 overflow-auto py-5 xl:pr-5",children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Input"}),e.jsx("section",{className:"flex-1",children:e.jsx(me,{control:i.control,name:"parameters",render:({field:l})=>e.jsx(Oe,{deploymentId:a,jsonSchema:r,value:l.value,onChange:l.onChange})})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 p-5",children:[e.jsx(d,{disabled:n,size:"md",type:"button",intent:"secondary",emphasis:"subtle",className:"bg-theme-surface-primary",onClick:()=>i.reset(),children:"Reset"}),e.jsx(d,{disabled:n,size:"md",type:"submit",children:"Run"})]})]})}function Le({authKey:s}){const t={...s?{Authorization:`Bearer ${s}`}:{},"Content-Type":"application/json"},n=function(r,i){return fetch(r,{...i,headers:{...t,...i?.headers}})};async function a(r,i){const o=`${r}/invoke`;return await n(o,{method:"POST",body:JSON.stringify(i)})}return{fetcher:n,invokeDeployment:a}}async function De({url:s,payload:t,authKey:n}){const r=await Le({authKey:n}).invokeDeployment(s,t);if(!r.ok){let i;throw r.status===422?i=(await r.json()).detail?.map(l=>`${l.loc[2]}: ${l.msg}`).join(", ")||"Validation error":i=await r.json().then(o=>Array.isArray(o)&&o.length>=2?o[1]:Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>`Failed to invoke ${s}`),new Z({status:r.status,statusText:r.statusText,message:i})}return r.json()}function Ve(s){return oe({...s,mutationFn:async t=>De(t)})}function He({runId:s,clearOutputs:t}){const n=le(),{toast:a}=b(),[r,i]=c.useState(!1),{mutate:o,isPending:l}=fe({onSuccess:()=>{n.invalidateQueries({queryKey:["runs"]}),t(),i(!1)},onError:w=>{a({status:"error",emphasis:"subtle",description:w.message,rounded:!0})}});function h(){o({runId:s})}return e.jsxs($,{open:r,onOpenChange:i,children:[e.jsx(J,{asChild:!0,children:e.jsx(d,{type:"button",intent:"danger",emphasis:"subtle",size:"md",children:"Delete"})}),e.jsx(he,{isPending:l,title:"Delete Run",handleDelete:()=>h(),children:e.jsxs(xe,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})]})}function Te({clearOutputs:s,runId:t}){return e.jsx("div",{className:"flex items-center justify-end p-5",children:t&&e.jsx(He,{runId:t,clearOutputs:s})})}const C=c.forwardRef(({className:s,...t},n)=>e.jsx(d,{...t,ref:n,intent:"secondary",emphasis:"subtle",className:u("group flex items-center justify-center rounded-sharp border-none data-[state=active]:bg-primary-50",s),children:t.children}));C.displayName="PlaygroundViewSwitcherButton";function Ae({activeView:s,setActiveView:t,className:n,children:a}){return e.jsx(R,{className:u("w-fit overflow-hidden rounded-md border border-theme-border-moderate bg-theme-surface-primary",n),value:s,onValueChange:r=>t(r),children:a})}function Re({activeView:s,setActiveView:t}){return e.jsx(Ae,{activeView:s,setActiveView:n=>t(n),children:e.jsxs(M,{className:"flex items-center",children:[e.jsx(S,{asChild:!0,value:"preview",children:e.jsx(C,{children:"Preview"})}),e.jsx(S,{asChild:!0,value:"json",children:e.jsx(C,{children:"JSON"})})]})})}function Me({activeView:s,setActiveView:t}){return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Output"}),e.jsx(Re,{activeView:s,setActiveView:t})]})}function ze({runId:s}){const t=ye({runId:s});if(t.isPending)return e.jsx(Q,{className:"h-5 w-[100px]"});if(t.isError)return e.jsx("div",{});const n=t.data?.resources?.user;return n?e.jsx(W,{username:n.name,isServiceAccount:!!n.body?.is_service_account,avatarUrl:n.body?.avatar_url||void 0}):e.jsx("div",{})}function Fe({runId:s,runName:t,duration:n,success:a}){const r=a?"completed":"failed";return e.jsxs(U,{className:"space-y-3 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-1",children:[e.jsxs("div",{className:"max-w-full",children:[e.jsx("p",{className:"text-text-xs text-theme-text-tertiary",children:"Run"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"truncate font-semibold",children:t}),e.jsx(G,{className:"size-3 shrink-0",status:a?"completed":"failed"})]})]}),s&&e.jsx(d,{intent:"secondary",size:"sm",emphasis:"subtle",className:"w-fit whitespace-nowrap",asChild:!0,children:e.jsx(je,{to:K.projects.runs.detail(s),children:"Run Details"})})]}),e.jsxs("div",{className:"flex w-full flex-wrap items-center justify-between gap-1",children:[s?e.jsx(ze,{runId:s}):e.jsx("div",{}),e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:[e.jsx("span",{className:"capitalize data-[status=completed]:text-theme-text-success data-[status=failed]:text-theme-text-error","data-status":r,children:r}),"·",e.jsx("span",{children:q(n)})]})]})]})}const _e=s=>c.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{d:"M11 16C11 15.4477 11.4477 15 12 15C12.5523 15 13 15.4477 13 16V19.5859L14.293 18.293C14.6835 17.9024 15.3165 17.9024 15.707 18.293C16.0976 18.6835 16.0976 19.3165 15.707 19.707L12.707 22.707C12.3165 23.0976 11.6835 23.0976 11.293 22.707L8.29297 19.707C7.90244 19.3165 7.90244 18.6835 8.29297 18.293C8.68349 17.9024 9.31651 17.9024 9.70703 18.293L11 19.5859V16ZM4 11C4.55228 11 5 11.4477 5 12C5 12.5523 4.55228 13 4 13H2C1.44772 13 1 12.5523 1 12C1 11.4477 1.44772 11 2 11H4ZM10 11C10.5523 11 11 11.4477 11 12C11 12.5523 10.5523 13 10 13H8C7.44772 13 7 12.5523 7 12C7 11.4477 7.44772 11 8 11H10ZM16 11C16.5523 11 17 11.4477 17 12C17 12.5523 16.5523 13 16 13H14C13.4477 13 13 12.5523 13 12C13 11.4477 13.4477 11 14 11H16ZM22 11C22.5523 11 23 11.4477 23 12C23 12.5523 22.5523 13 22 13H20C19.4477 13 19 12.5523 19 12C19 11.4477 19.4477 11 20 11H22ZM11 8V4.41406L9.70703 5.70703C9.31651 6.09756 8.68349 6.09756 8.29297 5.70703C7.90244 5.31651 7.90244 4.68349 8.29297 4.29297L11.293 1.29297L11.3662 1.22656C11.5442 1.08073 11.7679 1 12 1C12.2652 1 12.5195 1.10543 12.707 1.29297L15.707 4.29297C16.0976 4.68349 16.0976 5.31651 15.707 5.70703C15.3165 6.09756 14.6835 6.09756 14.293 5.70703L13 4.41406V8C13 8.55228 12.5523 9 12 9C11.4477 9 11 8.55228 11 8Z"})),Be=s=>c.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{d:"M11 22V18.4141L9.70703 19.707C9.31651 20.0976 8.68349 20.0976 8.29297 19.707C7.90244 19.3165 7.90244 18.6835 8.29297 18.293L11.293 15.293L11.3662 15.2266C11.5442 15.0807 11.7679 15 12 15C12.2652 15 12.5195 15.1054 12.707 15.293L15.707 18.293C16.0976 18.6835 16.0976 19.3165 15.707 19.707C15.3165 20.0976 14.6835 20.0976 14.293 19.707L13 18.4141V22C13 22.5523 12.5523 23 12 23C11.4477 23 11 22.5523 11 22ZM4 11C4.55228 11 5 11.4477 5 12C5 12.5523 4.55228 13 4 13H2C1.44772 13 1 12.5523 1 12C1 11.4477 1.44772 11 2 11H4ZM10 11C10.5523 11 11 11.4477 11 12C11 12.5523 10.5523 13 10 13H8C7.44772 13 7 12.5523 7 12C7 11.4477 7.44772 11 8 11H10ZM16 11C16.5523 11 17 11.4477 17 12C17 12.5523 16.5523 13 16 13H14C13.4477 13 13 12.5523 13 12C13 11.4477 13.4477 11 14 11H16ZM22 11C22.5523 11 23 11.4477 23 12C23 12.5523 22.5523 13 22 13H20C19.4477 13 19 12.5523 19 12C19 11.4477 19.4477 11 20 11H22ZM11 2C11 1.44772 11.4477 1 12 1C12.5523 1 13 1.44772 13 2V5.58594L14.293 4.29297C14.6835 3.90244 15.3165 3.90244 15.707 4.29297C16.0976 4.68349 16.0976 5.31651 15.707 5.70703L12.707 8.70703C12.3165 9.09756 11.6835 9.09756 11.293 8.70703L8.29297 5.70703C7.90244 5.31651 7.90244 4.68349 8.29297 4.29297C8.68349 3.90244 9.31651 3.90244 9.70703 4.29297L11 5.58594V2Z"}));function Ie({expanded:s,className:t}){const n=u("size-3 shrink-0",t);return s?e.jsx(Be,{className:n}):e.jsx(_e,{className:n})}function v(s){return s.length>be}function Ze({value:s}){const[t,n]=c.useState(!1),a=v(s),r=a&&!t;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`whitespace-pre-wrap ${r?"max-h-[200px] overflow-hidden":""}`,children:s}),r&&e.jsx("div",{className:"from-bg-theme-surface-primary pointer-events-none absolute bottom-0 left-0 right-0 h-[100px] bg-gradient-to-t from-theme-surface-primary to-transparent"})]}),a&&e.jsxs("button",{onClick:()=>n(!t),className:"flex items-center gap-1 text-primary-400",children:[e.jsx(Ie,{expanded:t}),t?"Show less":"Show more"]})]})}function $e({value:s,className:t}){return e.jsxs("div",{children:[s===!0?e.jsx(X,{className:u("h-4 w-4 shrink-0 fill-theme-text-success",t)}):e.jsx(ve,{className:u("h-4 w-4 shrink-0 fill-theme-text-tertiary",t)}),e.jsx("span",{className:"sr-only",children:s?"True":"False"})]})}function N({value:s,alwaysOpen:t=!1}){if(s===null)return e.jsx("div",{children:"null"});if(Y(s))return e.jsx($e,{value:s});if(p(s)&&ee(s))return e.jsx("a",{className:"underline transition-all duration-200 hover:decoration-transparent",href:s,target:"_blank",rel:"noopener noreferrer",children:s});const n=p(s)?s:JSON.stringify(s,null,2);return t?e.jsx("div",{className:"whitespace-pre-wrap",children:n}):e.jsx(Ze,{value:n})}function D(s,t=!0){const n={},a={},r={};for(const[o,l]of Object.entries(s||{}))j(l)?n[o]=l:g(l)?r[o]=l:a[o]=l;const i=Object.entries(a);return t&&i.sort((o,l)=>o[0].localeCompare(l[0])),{objects:n,nonObjects:i,arrays:r}}function V({open:s,className:t,title:n,children:a,...r}){return e.jsxs(z,{className:u("space-y-3",t),...r,children:[e.jsxs(F,{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"size-3",open:s??!1})," ",n]}),e.jsx(_,{className:"pl-5",children:a})]})}function Je({value:s,title:t}){const[n,a]=c.useState(!1);return e.jsx(V,{title:t,open:n,onOpenChange:a,children:e.jsx(H,{value:s})})}function H({value:s}){const t=s.filter(a=>!g(a)&&!j(a)||a===null),n=s.filter(a=>g(a)||j(a));return e.jsxs("ul",{className:"space-y-3",children:[t.map((a,r)=>{const i=p(a)&&v(a);return e.jsxs("li",{className:i?"grid grid-cols-1 gap-y-2":"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[e.jsx("p",{className:`text-theme-text-secondary ${i?"":"md:col-span-1"}`,children:r}),e.jsx("div",{className:i?"":"md:col-span-2",children:e.jsx(N,{value:a})})]},r)}),n.map((a,r)=>e.jsx("li",{children:e.jsx(T,{title:r.toString(),value:a},r)},r))]})}function T({value:s,title:t}){const[n,a]=c.useState(!1);return e.jsx(V,{title:t,open:n,onOpenChange:a,children:e.jsx(A,{value:s})})}function A({value:s}){const{objects:t,nonObjects:n,arrays:a}=D(s);return e.jsxs("ul",{className:"space-y-3",children:[n.map(([r,i])=>{const o=p(i)&&v(i);return e.jsxs("li",{className:o?"grid grid-cols-1 gap-y-2":"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[e.jsx("p",{className:`text-theme-text-secondary ${o?"":"md:col-span-1"}`,children:r}),e.jsx("div",{className:o?"":"md:col-span-2",children:e.jsx(N,{value:i})})]},r)}),Object.entries(t).map(([r,i])=>e.jsx(T,{title:r,value:i},r)),Object.entries(a).map(([r,i])=>e.jsx(Je,{value:i,title:r},r))]})}function Qe({json:s}){const{objects:t,nonObjects:n,arrays:a}=D(s);return e.jsxs("div",{className:"space-y-3",children:[n.map(([r,i],o)=>e.jsx(x,{headerClassName:"p-3",initialOpen:!0,title:r,children:e.jsx(N,{alwaysOpen:!0,value:i})},o)),Object.entries(t).map(([r,i],o)=>e.jsx(x,{headerClassName:"p-3",initialOpen:!0,title:r,children:e.jsx(A,{value:i})},o)),Object.entries(a).map(([r,i],o)=>e.jsx(x,{headerClassName:"p-3",initialOpen:!0,title:r,children:e.jsx(H,{value:i})},o))]})}function We({outputs:s,clearOutputs:t}){const[n,a]=c.useState("preview"),{metadata:r}=s;return e.jsxs("div",{className:"flex h-full w-full flex-col divide-y divide-theme-border-moderate",children:[e.jsxs("div",{className:"flex h-full flex-col gap-5 overflow-y-auto py-5 pl-5 pr-5 xl:pr-0",children:[e.jsx(Me,{activeView:n,setActiveView:a}),e.jsx("div",{children:e.jsx(Fe,{success:s.success,runId:r.run_id||void 0,runName:r.run_name||void 0,duration:s.execution_time})}),s.success===!0?n==="preview"?e.jsx(Qe,{json:s.outputs}):e.jsx(L,{theme:"github-light",value:JSON.stringify(s.outputs,null,"	"),language:"json",options:{minimap:{enabled:!1},readOnly:!0,wrappingStrategy:"advanced",wordWrap:"on",wordWrapColumn:80},className:"h-full min-h-[200px] border border-theme-border-moderate md:min-h-[auto]"}):e.jsx(m,{title:"Failed to invoke deployment",subtitle:s.error||"Failed to invoke deployment"})]}),e.jsx(Te,{runId:r.run_id||void 0,clearOutputs:t})]})}function Ue(){return e.jsx("div",{className:"flex h-full flex-1 rounded-md border border-dashed border-theme-border-moderate py-5 pl-5 pr-5 xl:pr-0",children:e.jsx(m,{subtitle:"Invoke a run to see its outputs"})})}function Ge({outputs:s,isInvoking:t,clearOutputs:n}){return t?e.jsx(y,{subtitle:"Invoking Endpoint..."}):s?e.jsx(We,{outputs:s,clearOutputs:n}):e.jsx("div",{className:"h-full py-5 pl-5 pr-5 xl:pr-0",children:e.jsx(Ue,{})})}function Ke({snapshot:s,deployment:t}){const{toast:n}=b(),a=Ve({onError:i=>{i instanceof Error&&n({status:"error",emphasis:"subtle",rounded:!0,description:i.message}),console.error(i)},onSuccess:i=>{console.log(i)}});function r(i){const o=t.metadata?.auth_key,l=t.body?.url;if(!l){n({status:"error",emphasis:"subtle",rounded:!0,description:"URL is not set"});return}a.mutate({authKey:o??void 0,url:l,payload:{parameters:i}})}return e.jsxs(Ne,{direction:"horizontal",className:"h-full !flex-col md:!flex-row",children:[e.jsx(k,{minSize:33,defaultSize:50,children:e.jsx(Ee,{deploymentId:t.id,isInvoking:a.isPending,submitDeployment:r,snapshot:s})}),e.jsx(we,{className:"hidden w-[1px] bg-theme-border-moderate transition-colors duration-200 data-[resize-handle-state=drag]:bg-theme-border-bold data-[resize-handle-state=hover]:bg-theme-border-bold md:block"}),e.jsx(k,{minSize:33,defaultSize:50,className:"h-full bg-theme-surface-primary xl:pr-[80px]",children:e.jsx(Ge,{clearOutputs:()=>a.reset(),isInvoking:a.isPending,outputs:a.data})})]})}function fs(){const{deploymentId:s}=ge(),t=O(te.detail(s)),n=t.data?.resources?.snapshot?.id,a=O({...se.detail(n),enabled:!!n});if(t.isPending)return e.jsx(y,{subtitle:"Loading Deployment..."});if(t.isError)return e.jsx(f,{error:t.error});if(!n)return e.jsx(f,{error:new Error("Snapshot not found")});if(a.isPending)return e.jsx(y,{subtitle:"Loading Snapshot..."});if(a.isError)return e.jsx(f,{error:a.error});const r=a.data,i=t.data,o=i.body?.url;if(i.body?.status!=="running"||!o)return e.jsx(m,{subtitle:"Please make sure the deployment is running and has a URL"});const l=window.location.protocol==="https:",h=o.startsWith("http://");return l&&h&&Se?e.jsx(m,{title:"Cannot invoke deployment",subtitle:"Safari doesn’t allow HTTPS pages to connect to local HTTP services. Please use Chrome or Firefox, or run your local service with HTTPS."}):e.jsx(Ke,{snapshot:r,deployment:i})}export{fs as default};
